---
import MenuView from '@layouts/MenuView.astro'
---

<MenuView id="formatting" title="Text formatting">
  <div class="controls lh-control">
    <label for="line-height">
      <span class="lh-label">Line height</span>
      <output id="lh-output"></output>
    </label>
    <div class="lh-row">
      <span class="lh-icon small" aria-hidden="true">A</span>
      <input id="line-height" type="range" min="1" max="2" step="0.01" />
      <span class="lh-icon large" aria-hidden="true">A</span>
    </div>
  </div>
</MenuView>

<style lang="scss">
		.controls {
		display: flex;
		flex-direction: column;
		gap: var(--space-m);
		padding-right: var(--space-xl);
		padding-bottom: var(--space-l);
	}

	.lh-control {
		padding-top: var(--space-s);
	}

	.lh-row {
		display: flex;
		align-items: center;
		gap: var(--space-s);
	}

	.lh-icon {
		color: var(--color-main-50);
		user-select: none;
		width: 1.25rem;
		display: inline-flex;
		align-items: center;
		justify-content: center;
	}

	.lh-icon.small { font-size: 0.8rem }
	.lh-icon.large { font-size: 1.15rem }

	label {
		font-size: var(--font-size-s);
		color: var(--color-main-50);
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	input[type="range"] {
		width: 100%;
	}

	#reset-format {
		margin-top: var(--space-m);
	}
</style>
<script is:inline>
	(function () {
		const editorEl = document.getElementById('editor') || document.documentElement

		function readVar(name, fallback) {
			const v = getComputedStyle(editorEl).getPropertyValue(name) || getComputedStyle(document.documentElement).getPropertyValue(name)
			return v ? parseFloat(v) : fallback
		}

		function formatNumber(n) {
			return Number(n).toFixed(2)
		}

		function init() {
			const lhInput = document.getElementById('line-height')
			const lhOut = document.getElementById('lh-output')

			const storedLH = localStorage.getItem('line-height')
			const initialLH = storedLH ? parseFloat(storedLH) : readVar('--line-height', 1.4)

			if (lhInput) lhInput.value = String(initialLH)
			if (lhOut) lhOut.textContent = formatNumber(initialLH)

			// Scope the variable to the editor element only so menus and overlays are unaffected
			editorEl.style.setProperty('--line-height', String(initialLH))

			if (lhInput) {
				lhInput.addEventListener('input', (e) => {
					const target = e.target
					if (!(target instanceof HTMLInputElement)) return
					const v = target.value
					editorEl.style.setProperty('--line-height', v)
					if (lhOut) lhOut.textContent = formatNumber(v)
					localStorage.setItem('line-height', v)
				})
			}
		}

		if (document.readyState === 'loading') {
			document.addEventListener('DOMContentLoaded', init)
		} else {
			init()
		}
	})()
</script>
